# msa-capstone-project
<img src= "https://t1.daumcdn.net/cfile/tistory/997A00365C79475E04?download">


  
## 👫 Team

   |팀|성명|직급|사번|소속||
   |:----:|:------:|:------:|:------|:------|------|
   |2|🎖서정훈|과장|201600017|서비스혁신센터|제조방산담당/방산운영2팀|
   ||  신세호|대리|202100009|서비스혁신센터|제조방산담당/제조운영팀|
   ||   정호현|사원|201903684|데이터센터|금융운영팀|

# 서비스 시나리오

기능적 요구사항
1. 사용자가 주문을 한다
2. 주문이 시작되면 배송이 시작된다
3. 주문이 시작되면 재고가 감소한다
4. 주문이 취소되면 배송이 취소된다
5. 주문이 취소되면 재고가 증가한다


비기능적 요구사항
1. 마이크로 서비스를 넘나드는 시나리오에 대한 트랜잭션 처리
2. 주문시 재고가 있는지 확인한다
3. 고객이 주문상태를 주문시스템에서 확인할 수 있어야 한다 (CQRS)


# SAGA
## - 구현
> 서비스를 아래와 같은 방법으로 개별적으로 실행한다. 

```
cd order
mvn spring-boot:run
```

```
cd orderView
mvn spring-boot:run
```

```
cd delivery
mvn spring-boot:run
```

```
cd inventory
mvn spring-boot:run
```

## - DDD적용
> 4개의 도메인으로 관리되고 있으며 주문(Order), 배송(Delivery), 재고(Inventory), 주문조회(OrderView)으로 구성된다.

```
@Entity
@Table(name="Order_table")
public class Order  {

    @Id
    @GeneratedValue(strategy=GenerationType.AUTO)
    private Long id;
    private Long deliveryId;
    private String productName;
    private String productId;
    private Integer qty;
    private String address;
    private String orderStatus;

    @PostPersist
    public void onPostPersist(){
        Ordered ordered = new Ordered();
        BeanUtils.copyProperties(this, ordered);

        onlineshop.external.Inventory inventory = new onlineshop.external.Inventory();
        OrderApplication.applicationContext.getBean(onlineshop.external.InventoryService.class).deductStock(inventory);

        ordered.publishAfterCommit();
    }
    
```
