# This configuration file was automatically generated by Gitpod.
# Please adjust to your needs (see https://www.gitpod.io/docs/config-gitpod-file)
# and commit this file to your remote git repository to share the goodness with others.

tasks:
  - name: httpie
    command: pip install httpie

  - name: siege
    command: >
      sudo apt-get install siege &&
      siege -V
    
  # - name: kafka
  #   command: > 
  #     cd kafka &&
  #     docker-compose up -d
  # - name: kafka
  #   command: |
  #     cat <<EOF > docker-compose-single-broker.yml
  #     version: '2'
  #     services:
  #       zookeeper:
  #         image: confluentinc/cp-zookeeper:latest
  #         environment:
  #           ZOOKEEPER_CLIENT_PORT: 2181
  #           ZOOKEEPER_TICK_TIME: 2000
  #         ports:
  #           - 22181:2181
        
  #       kafka:
  #         image: confluentinc/cp-kafka:latest
  #         depends_on:
  #           - zookeeper
  #         ports:
  #           - 29092:29092
  #         environment:
  #           KAFKA_BROKER_ID: 1
  #           KAFKA_ZOOKEEPER_CONNECT: zookeeper:2181
  #           KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://kafka:9092,PLAINTEXT_HOST://localhost:29092
  #           KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: PLAINTEXT:PLAINTEXT,PLAINTEXT_HOST:PLAINTEXT
  #           KAFKA_INTER_BROKER_LISTENER_NAME: PLAINTEXT
  #           KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: 1
  #     EOF
  #     docker-compose -f docker-compose-single-broker.yml up -d

  - name: yq
    command: |
      sudo wget https://github.com/mikefarah/yq/releases/download/v4.25.1/yq_linux_amd64 -O /usr/bin/yq
      sudo chmod +x /usr/bin/yq
      gp sync-done yq

  - name: kafka
    command: |
      gp sync-await yq
      git clone https://github.com/wurstmeister/kafka-docker
      cd kafka-docker
      yq -i '.services.kafka.environment.KAFKA_ADVERTISED_HOST_NAME = "127.0.0.1"' docker-compose-single-broker.yml
      docker-compose -f docker-compose-single-broker.yml up -d

  - name: kubectl
    command: >
      curl -LO https://dl.k8s.io/release/v1.21.0/bin/linux/amd64/kubectl &&
      sudo install -o root -g root -m 0755 kubectl /usr/local/bin/kubectl &&
      kubectl version --client &&
      gp sync-done init-kubectl
      
  - name: python
    init: gp sync-await init-kubectl
    command: >
      sudo apt install python-is-python3 &&
      gp sync-done init-python
      
  - name: awscli
    init: gp sync-await init-python
    command: >
      curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip" &&
      unzip awscliv2.zip &&
      sudo ./aws/install &&
      gp sync-done init-awscli
    
  - name: eksctl
    init: gp sync-await init-awscli
    command: >
      curl --location "https://github.com/weaveworks/eksctl/releases/latest/download/eksctl_$(uname -s)_amd64.tar.gz" | tar xz -C /tmp &&
      sudo mv /tmp/eksctl /usr/local/bin &&
      eksctl version &&
      gp sync-done init-eksctl
      
  - name: boot
    init: gp sync-await init-eksctl
    command: >
      cat ./config/init
